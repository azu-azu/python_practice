2025/08/09 10:32

# range(n - 1 - i)

  ## 要点

  • `n`: 配列の長さ
  • 外側ループ `i`: バブルソートの「パス（周回）」回数。
    1周ごとに未整列部分の末尾に最大（または最小）が確定します。

  • 内側ループ `range(n - 1 - i)` の意味:
    • `-1` の理由:
      比較は arr[j] と arr[j+1] のペアなので、j は最大でも n-2 まで。よって基本は range(n-1) 回の比較。

    • `- i` の理由:
      周回が進むほど末尾に確定済み要素が増えるため、それらはもう比較不要。周回 i の時点で末尾に i 個が確定済みなので、比較回数を i だけ減らす。


  ## なぜ正しい・安全か

  • 正しさ: 各パスで未整列領域の最大値が末尾（インデックス n-1-i）へ「バブルアップ」するため、次のパスではその末尾を比較対象から外せます。
  • 境界安全性: j は 0 .. (n-2-i)、比較相手は j+1。このとき j+1 <= n-1-i < n を満たし、IndexError を防ぎます。


  ## 具体例（`n = 5`）

  • i = 0: range(4) → j = 0..3（4回）末尾[4]が確定
  • i = 1: range(3) → j = 0..2（3回）末尾[3]も確定
  • i = 2: range(2) → j = 0..1（2回）
  • i = 3: range(1) → j = 0（1回）
  • i = 4: range(0) → 比較なし（0回）

  ## 補足: 実装にある「swapped が一度も立たなければ break」最適化により、早期終了も可能です。
  • range(n - 1 - i) は、ペア比較の上限（-1）と、末尾の確定済み要素（-i）を同時に反映した回数指定です。
